# 授業まとめ

## データリンク層

### 基本形データ伝送制御手順の伝送フェーズ

［フェーズ1］ 回線の接続（ネットワーク側）
［フェーズ2］ データリンクの確立
［フェーズ3］ 情報の転送
［フェーズ4］ データリンクの終結
［フェーズ5］ 回線の切断（ネットワーク側）

### HDLC

* 昔の技術
* 同時の双方向通信
* 連続ARQ
* 1次局はPを送信すると2次局の送信を許可、２次局はF(まだ送信し切っていないときはF(P)を送信しない)
* データリンクの確立は[SNRM, P]と[UA, F]
* データリンクの集結は[DISC, P]と[UA ,F]
* 再送コマンド[REJ]go-back-N 誤りのとこから全部
* 再送コマンド[SREJ]selective repeat 誤りのとこだけ
* I(j, k):送信シーケンス番号が j で，受信シーケンス番号が k の情報フレーム
* RR(k):受信シーケンス番号が k の受信通知
<!-- * 正規応答モード　　NRM　　UN
* 非同期応答モード　ARM　　UA
* 非同期平衡モード　ABM　　BA -->

## データ交換とネットワーク層

### 回線交換
利点
* メッセージに用いる符合に制約がない
* 網内遅延がない
* 長いメッセージ・高密度の通信に適している
欠点
* プロトコルや通信速度の異なる端末間の通信はできない
* 回線を設定した端末が回線を使用していなくても他の端末は使用できない

### パケット交換
利点
* 一本の回線で多数の端末と通信可能(論理多重)
* プロトコルや通信速度の異なる端末と通信可
* 情報量比例課金が可能(短いメッセージ・低密度の通信に適している)
欠点
* 網内遅延がある(パケットごとにメモリに蓄積するから)
* プロトコルのオーバーベッドがある

### ホップバイホップルーティング(の中の距離ベクトルルーティング)

### TCP/IPにおける距離ベクトル型ルーティングプロトコル

#### RIP (Routing Information Protocol)
* 動的なIGPの一つ
* ネットワークの距離をMetricで表現
* Metricをホップスで定義
* 送信先へは一つのルート

#### OSPF (Open Shortest Path Fast)
* 動的なIGPの一つ
* 直接IPでカプセル化しトランスポート層を使わない
* 精密な経路制御、経路の素早い収束
* ネットワーク距離はコストで定義

### 輻輳制御(ふくそうせいぎょ)
* 呼受付制御：輻輳が生じたら新たに発生したパケットをネットワークに入れない
* フロー制御：TCPのウィンドウフロー制御、スロースターと
* トラフィックシェーピング：リーキィバケットアルゴリズム
* パケット廃棄：RED

## TCPIP

### IP
* ホスト間の通信、IPアドレスによる識別
* ネットワーク層プロトコル
* コネクションレス型
* BestEffort(QOS非保証)
* データグラム： IPで扱われるメッセージの単位(IPパケット)
* IPルーティング：IPアドレスを利用してデータグラムを宛先アドレスまで届ける機能
* IPモジュール：IPの役割を果たすソフトウェア
* IPアドレス：計算機を一意に識別(名工大はクラスB)
* サブネット化技術：ホスト部をサブネット部とホスト部に分割(ANDで取り出せる、0のみと１のみは特別)

### TCP
* プロセス間の通信、ポート番号による識別
* ストリーム指向：オクテットに分割されているビットストリームを転送
* 非構造化ストリーム
* コネクション型
* バッファ付き転送：十分なデータを集めてから適切な大きさのデータグラムにする
* 全二重コネクション
* ピギィバック：制御情報等を反対方向にデータを運ぶデータグラムに相乗せして返送する方式

### コネクションの確立

#### 三方向ハンドシェイク
1. 最初のセグメント : SYNビットをセット
2. ２番目のセグメント : SYNビットとACKビットをセット
3. 最後のセグメント : ACKビットをセット

#### 緩やかな切断
1. FIN(A→B)
2. ACK(B→A)
3. FIN(A→B)
4. ACK(B→A)

# 小テスト

## 9
SNRMとDISCとUAを覚えていればいけそう

## 10
回線交換は最大速度の合計
パケット交換は各時間の速度の合計

## 11
与えられている表にDからの距離をたす
その後宛先に行く最短を選び、nexthopが三つの道のどれかを決める
それ自体は直接接続

## 12
IPパケットはIPヘッダとUDPヘッダをつけてカプセル化する
受信端末にも制限がある場合、IPパケットを分割する。
その際分割した一つ一つにIPヘッダをつける
受信するIPパケット
Total Length(TL)：IPパケットのサイズ
Identification(ID)：送信したときのID（受信側で分割されても同じ）
More Fragment(MF)：まだ分割されたIPパケットが続くなら１続かないなら０
Fragment Offset(FO)：よくわからんがそれまで送ったものの合計を８で割ったもの。分割が終わると０に戻る

## 13
SYNにも通番が１つ割り当てられることに注意
コネクションの確立
① A->B [SYN (Seq200, Ack000)] ※まだコネクションは確率されていないので，Ack番号は何でも構いません
② B->A [SYN, ACK (Seq300, Ack201)] ※端末AからのSYNにも通番が１つ割り当てられます
③ A->B [ACK (Seq201, Ack301)] ※端末BからのSYNにも通番が１つ割り当てられます
コネクションの終了
⑬ A->B [FIN, ACK (Seq5201, Ack301)]
⑭ B->A [ACK (Seq301, Ack5202)]  ※端末AからのFINにも通番が１つ割り当てられます ⑭と⑮はまとめても構いません
⑮ B->A [FIN, ACK (Seq301, Ack5202)]
⑯ A->B [ACK (Seq5202, Ack302)] ※端末BからのFINにも通番が１つ割り当てられます

## 14
ヘッダをデータに足す
20+20+20+740 = 800
伝送遅延は衛星回線の回線速度128kbit/secから計算できる
800 × 8 / 128000 = 50 × 10-3
伝送遅延プラス往復の伝搬遅延の分だけ時間がかかるので
スループットは6400 / (640 × 10-3)
ウィンドウごとに確認応答する場合、ウィンドウサイズ分のフレームを送信してからACKを待ちます。
1サイクル時間 = (ウィンドウサイズ × 伝送遅延) + 往復伝搬遅延
送れるデータもウィンドウのサイズだけ増える
スライディングウィンドウでは、ACKが戻ってくる前に次のフレームを連続的に送信できます。
理論的最大スループット = (実効データ ÷ フレーム全体) × 回線速度
= (740 ÷ 800) × 128 = 118.4 kbit/sec
パイプライン容量 = (往復遅延時間 ÷ 1フレーム伝送時間) + 1
= (0.59 ÷ 0.05) + 1 = 約13フレーム

# 過去問